<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Movie Information</title>
  <link rel="icon" href="Assets/Images/MN_Favi.png" type="image/png" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <script src="https://kit.fontawesome.com/8e3f3e5f4e.js" crossorigin="anonymous"></script>
</head>
<body>
  <!-- Background Overlay (Always Default BG) -->
  <div class="background-overlay"></div>

  <!-- Load header and menu -->
  <script>
    fetch("header.html")
      .then(res => res.text())
      .then(data => document.body.insertAdjacentHTML("afterbegin", data));

    fetch("menu.html")
      .then(res => res.text())
      .then(data => document.body.insertAdjacentHTML("afterbegin", data));
  </script>

  <main>
    <section class="movie-info-section">
      <!-- Dynamic blurred backdrop set by JS -->
      <div class="movie-backdrop-blur" id="movie-backdrop-blur"></div>

      <!-- Embed Video First -->
      <div class="movie-embed-video">
        <img id="movie-embed-poster" src="" alt="Movie Landscape Poster" />
        <div class="overlay">The choice is yoursâ€¦ Select the Source below!</div>
        <iframe id="movie-player" width="100%" height="480" src="" frameborder="0" allowfullscreen style="display: none;"></iframe>
      </div>

      <!-- Source Buttons -->
      <div class="source-buttons" id="source-buttons">
        <button id="source1-button">Source 1</button>
        <button id="source2-button">Source 2</button>
        <div id="additional-sources"></div>
      </div>

      <!-- Poster & Info -->
      <div class="movie-info-container">
        <div class="movie-poster">
          <img id="movie-poster" src="" alt="Movie Poster" />
        </div>

        <div class="movie-details">
          <h2 id="movie-title"></h2>
          <p id="movie-overview"></p>

          <div id="movie-info">
            <p><strong>Release Date:</strong> <span id="release-date"></span></p>
            <p><strong>Rating:</strong> <span id="rating"></span></p>
            <p><strong>Genres:</strong> <span id="genres"></span></p>
            <p><strong>Language:</strong> <span id="language"></span></p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    const API_KEY = "e3afd4c89e3351edad9e875ff7a01f0c";
    const IMG_URL = "https://image.tmdb.org/t/p/";
    const FALLBACK_POSTER = "Assets/Images/Black%20and%20White%20Modern%20Coming%20soon%20Poster.png";

    const movieId = new URLSearchParams(window.location.search).get('id');
    const movieURL = `https://api.themoviedb.org/3/movie/${movieId}?api_key=${API_KEY}`;

    fetch(movieURL)
      .then(res => res.json())
      .then(async movie => {
        const movieTitle = document.getElementById("movie-title");
        const movieOverview = document.getElementById("movie-overview");
        const moviePoster = document.getElementById("movie-poster");
        const movieBackdropBlur = document.getElementById("movie-backdrop-blur");
        const releaseDate = document.getElementById("release-date");
        const rating = document.getElementById("rating");
        const genres = document.getElementById("genres");
        const language = document.getElementById("language");

        movieTitle.innerText = movie.title;
        movieOverview.innerText = movie.overview || "No description available";
        moviePoster.src = movie.poster_path ? IMG_URL + "w500" + movie.poster_path : FALLBACK_POSTER;
        movieBackdropBlur.style.backgroundImage = `url(${IMG_URL}w1280${movie.backdrop_path})`;

        releaseDate.innerText = movie.release_date;
        rating.innerText = movie.vote_average;
        genres.innerText = movie.genres.map(genre => genre.name).join(", ");
        language.innerText = movie.original_language;

        // Video Sources (vidsrc.to, embed.su, etc.)
        const sourceButtons = document.getElementById("source-buttons");
        const sources = await fetch('https://raw.githubusercontent.com/animeneek/MovieNeek/main/MovieNeek.json')
          .then(res => res.json());

        sources.forEach(source => {
          const button = document.createElement("button");
          button.innerText = source.label;
          button.onclick = () => {
            document.getElementById('movie-player').style.display = "block";
            document.getElementById('movie-player').src = source.url;
          };
          sourceButtons.appendChild(button);
        });
      });
  </script>
</body>
</html>
